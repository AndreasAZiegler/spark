---
- name: Install NetworkManager and dependencies
  pacman: name={{ item }} state=present
  with_items:
      - networkmanager
      - networkmanager-openvpn
      - network-manager-applet
      - xfce4-notifyd
      - gnome-keyring

- name: Push connectivity check config
  template: src=connectivity.conf.j2 dest=/etc/NetworkManager/conf.d/20-connectivity.conf
  when: network.conn_check is defined

- name: Enable and start NetworkManager
  service: name=NetworkManager.service enabled=yes state=started

- name: Enable and start NetworkManager dispatcher
  service: name=NetworkManager-dispatcher.service enabled=yes state=started

- name: Install nmtrust
  aur:
      name: nmtrust-git
      user: "{{ user.name }}"
  tags:
    - aur

- name: Create nmtrust config directory
  file:
      path: /etc/nmtrust
      state: directory

- name: Push trusted network list
  template:
      src: trusted_networks.j2
      dest: /etc/nmtrust/trusted_networks

- name: Verify trusted unit list exists
  file:
      path: /etc/trusted_units
      state: touch
